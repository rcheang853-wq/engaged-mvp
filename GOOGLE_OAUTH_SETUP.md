# Google OAuth Setup Guide

This document provides step-by-step instructions for configuring Google OAuth authentication for the Engaged App using Supabase.

## Prerequisites

- A Google Account
- Access to [Google Cloud Console](https://console.cloud.google.com/)
- Access to your Supabase Dashboard

---

## Part 1: Create Google OAuth Credentials

### Step 1: Create a New Google Cloud Project

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Click the project dropdown in the top-left corner
3. Click "New Project"
4. Enter a project name (e.g., "Engaged App Auth")
5. Click "Create"

### Step 2: Configure OAuth Consent Screen

1. In the left sidebar, navigate to **APIs & Services** > **OAuth consent screen**
2. Select **External** user type
3. Click "Create"
4. Fill in the required information:
   - **App name**: Engaged App
   - **User support email**: Your support email address
   - **Email addresses**: Add your email address
5. Click "Save and Continue"
6. Skip theScopes section (no additional scopes needed for basic auth)
7. Click "Save and Continue"
8. Under **Test users**, add any Google accounts you want to use for testing
9. Click "Save and Continue"
10. Review the summary and click "Back to Dashboard"

### Step 3: Create OAuth Credentials

1. In the left sidebar, navigate to **APIs & Services** > **Credentials**
2. Click "Create Credentials" > **OAuth client ID**
3. Configure the following:
   - **Application type**: Web application
   - **Name**: Engaged App OAuth
4. Under **Authorized redirect URIs**, add:
   - Development: `http://localhost:3000/auth/callback`
   - Production: `https://your-production-domain.com/auth/callback`
5. Click "Create"
6. Copy and save the **Client ID** and **Client Secret** - you'll need these for Supabase configuration

### Step 4: Note Your Client Credentials

After creating the OAuth client, you'll see:
- **Client ID**: `[YOUR_CLIENT_ID].apps.googleusercontent.com`
- **Client Secret**: `[YOUR_CLIENT_SECRET]`

Save these securely - you'll need them for Supabase configuration.

---

## Part 2: Configure Supabase Dashboard

### Step 1: Access Supabase Dashboard

1. Go to your [Supabase Dashboard](https://supabase.com/dashboard)
2. Select your project
3. Navigate to **Authentication** > **Providers**

### Step 2: Enable Google Provider

1. Find **Google** in the providers list
2. Click to expand the Google configuration
3. Toggle **Enable Google** to ON

### Step 3: Configure Google Settings

Fill in the following fields:

| Field | Value |
|-------|-------|
| Client ID | The Client ID from Google Cloud Console |
| Client Secret | The Client Secret from Google Cloud Console |
| Redirect URL | `https://[your-project-ref].supabase.co/auth/v1/callback` |

**Note**: The Redirect URL is automatically generated by Supabase. It follows this pattern:
- Development: `https://[project-ref].supabase.co/auth/v1/callback`
- Production: Same URL (Supabase handles the routing)

### Step 4: Save Configuration

1. Click "Save"
2. Google OAuth provider is now enabled

---

## Part 3: Authorized Redirect URIs

### Required Redirect URIs

You need to configure redirect URIs in two places:

#### A. Google Cloud Console (OAuth Client)

Add these to your OAuth 2.0 Client credentials:

| Environment | Redirect URI |
|-------------|--------------|
| Development | `http://localhost:3000/auth/callback` |
| Production | `https://your-production-domain.com/auth/callback` |

#### B. Supabase Dashboard

Supabase automatically configures its own redirect URI:
```
https://[project-ref].supabase.co/auth/v1/callback
```

This is the callback URL that Google will redirect to after authentication, which then redirects to your app's callback page.

### Callback Flow

1. User clicks "Continue with Google" on `/auth/signin` or `/auth/signup`
2. User authenticates with Google
3. Google redirects to: `https://[project-ref].supabase.co/auth/v1/callback`
4. Supabase processes the OAuth exchange
5. Supabase redirects to: `http://localhost:3000/auth/callback?code=...`
6. Your app's callback page exchanges the code for a session
7. User is redirected to `/calendar`

---

## Part 4: Environment Variables (Optional)

If you need to manually configure OAuth in your environment, you can add these variables to your `.env.local`:

```bash
# Google OAuth (optional - can also be configured in Supabase Dashboard)
NEXT_PUBLIC_GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
```

**Note**: These are optional. The primary configuration happens in the Supabase Dashboard.

---

## Part 5: Testing the Integration

### Local Development Testing

1. Start your development server:
   ```bash
   npm run dev
   ```

2. Navigate to `/auth/signin` or `/auth/signup`

3. Click "Continue with Google"

4. Complete the Google sign-in flow

5. After successful authentication, you should be redirected to `/calendar`

### Production Testing

1. Deploy your changes to production

2. Ensure the production redirect URI is added to Google Cloud Console:
   - `https://your-production-domain.com/auth/callback`

3. Test the full OAuth flow from sign-in or sign-up pages

---

## Troubleshooting

### "redirect_uri_mismatch" Error

This error occurs when the redirect URI in Google doesn't match what's being used.

**Solution:**
1. Check that both development and production URIs are added to Google Cloud Console
2. Verify the exact format (no trailing slashes, correct protocol)

### User Not Redirected to /calendar

**Solution:**
1. Check that the callback page at `/auth/callback` is working
2. Verify Supabase session is being created properly
3. Check browser console for any errors

### Google Sign-In Not Appearing

**Solution:**
1. Verify Google provider is enabled in Supabase Dashboard
2. Check that credentials are correctly entered
3. Ensure your app is wrapped with `AuthProvider`

### Email Not Confirmed for OAuth Users

OAuth users bypass the email confirmation requirement by default. If you need to require confirmation:
1. Go to Supabase Dashboard > Authentication > Providers > Google
2. Enable "Secure your project" settings as needed

---

## Security Considerations

1. **Keep Client Secret Secure**: Never commit your Google Client Secret to version control
2. **Use HTTPS in Production**: Always use HTTPS for production OAuth flows
3. **Limit Test Users**: During development, restrict OAuth to test users in Google Cloud Console
4. **Review Redirect URIs**: Only add trusted domains to authorized redirect URIs
5. **Monitor Usage**: Review Google Cloud Console for any unusual activity

---

## Additional Resources

- [Supabase OAuth Documentation](https://supabase.com/docs/guides/auth/social-login)
- [Google OAuth Documentation](https://developers.google.com/identity/protocols/oauth2)
- [Google Cloud Console](https://console.cloud.google.com/)
- [Supabase Dashboard](https://supabase.com/dashboard)
