PHASE 4 â€” PUBLIC SHARING

Status: Phases 1-3 complete. Auth, calendar UI, and events CRUD are working.

Goal: Add public share functionality for personal events.

Tasks:

1. Database Migration (supabase/personal-events-share.sql):
   - Add share_slug column to personal_events table (TEXT, UNIQUE, NULLABLE)
   - Add share_enabled column (BOOLEAN, DEFAULT false)
   - Create index on share_slug for fast lookups
   - Create function to generate random share slugs (8-10 chars, URL-safe)
   - Create trigger to auto-generate share_slug on INSERT if share_enabled=true

2. Update Types (src/types/database.ts):
   - Add share_slug?: string | null to personal_events Row/Insert/Update types
   - Add share_enabled?: boolean to personal_events types

3. Update Event Service (src/lib/supabase/events.ts):
   - Add toggleShare(eventId, enabled) function
   - Add getEventByShareSlug(slug) function (no auth required)
   - Update createEvent to optionally enable sharing
   - Add regenerateShareSlug(eventId) function

4. Update Event Modal (src/components/calendar/personal-event-modal.tsx):
   - Add "Share" toggle switch
   - If enabled, show share link with copy button
   - Add "Regenerate Link" button
   - Show share status in modal

5. Create Public Share Page (src/app/e/[shareSlug]/page.tsx):
   - NO auth required (public route)
   - Fetch event by share_slug using getEventByShareSlug()
   - Display card showing:
     * Event title
     * Start/end time (formatted nicely)
     * Location (if present)
     * "Private notes hidden" message
   - Show 404 if slug not found or sharing disabled
   - Clean, simple design
   - Add "Get Engaged" CTA at bottom (link to signup)

6. Update Calendar Component (personal-events-calendar.tsx):
   - Add share icon/indicator on events that are shared
   - Show share status in event details

Constraints:
- Keep public page simple and clean
- No auth required for /e/[shareSlug]
- Notes must NEVER be exposed on public page
- Share slugs must be unique and hard to guess
- User can disable sharing anytime

Output when done:
- Summary of what was built
- SQL migration file location
- Test instructions (how to create shared event + view public link)

When completely finished, run:
clawdbot gateway wake --text "Phase 4 complete: Public event sharing implemented" --mode now
